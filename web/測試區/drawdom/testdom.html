<!DOCTYPE html>
<html>
<head>
<script src="https://cdn.rawgit.com/blowsie/Pure-JavaScript-HTML5-Parser/master/htmlparser.js"></script>
<script src="html2json.js"></script>
<link rel="stylesheet" href="https://en.js.cx/libs/domtree.css">
<script src="https://en.js.cx/libs/domtree.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>
const Elem = e => ({
  toJSON : () => ({
    name: 
      e.tagName,
    nodeType:
      1,
    children:
      Array.from(e.children, Elem)
  })
})

const html2json = e =>
  JSON.stringify(Elem(e), null, '  ')
  //JSON.stringify(Elem(e), (k, v) => v === undefined ? null : v)

function visitnode(e){
 len = e.childElementCount;
 for(i=0;i<len;i++){
  
 }
}
 

function do1(){
//s=html2json(document.children[0])
e = document.getElementById("ex")
console.log(e)
s=html2json(e)
console.log(s)
//s=JSON.parse(s)
drawHtmlTree(s, 'div.domtree', 690, 210);
}

  function dothis() {
//htmlstr = document.documentElement.innerHTML;
//htmlstr='<div><p>test</p></div>';

//var nx=html2json(htmlstr);

//tmp2.innerText=s;
//var data = { html: htmlstr };
//tmp2.innerText = JSON.stringify(data);
//s= JSON.stringify(jsonobj);
//tmp2.innerText=s;
 

let n6 = {"name":"HTML","nodeType":1,"children":[{"name":"HEAD","nodeType":1,"children":[]},{"name":"BODY","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n  The truth about elk.\n    "},{"name":"OL","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"\n      "},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"An elk is a smart"}]},{"name":"#text","nodeType":3,"content":"\n      "},{"name":"#comment","nodeType":8,"content":"comment"},{"name":"#text","nodeType":3,"content":"\n      "},{"name":"LI","nodeType":1,"children":[{"name":"#text","nodeType":3,"content":"...and cunning animal!"}]},{"name":"#text","nodeType":3,"content":"\n    "}]},{"name":"#text","nodeType":3,"content":"\n  \n"}]}]};

drawHtmlTree(n6, 'div.domtree', 690, 210);
 
  }

  document.addEventListener("DOMContentLoaded", dothis);

</script>
</head>
<body>
<textarea id="ex" style="width:600px;height:220px;">
 <html>
 <head></head>
 <body>
 <p>text</p>
 </body>
 </html>
</textarea>
<hr>
<div id="tmp2"><p>hello</p></div>
<hr>
<div class="domtree"></div>
<button onclick="do1()">test</button>
</body>
</html>